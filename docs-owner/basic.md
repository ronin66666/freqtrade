# basic

## Freqtrade terminology
术语解释：
- 策略（Strategy）：您的交易策略，告诉机器人如何进行交易。
- 交易（Trade）：开放的仓位。
- 开放订单（Open Order）：当前放在交易所的订单，尚未完成。
- 交易对（Pair）：可交易的货币对，通常以基础货币/报价货币的格式表示（例如XRP/USDT）。
- 时间框架（Timeframe）：使用的K线时间长度（如"5m"，"1h"等）。
- 指标（Indicators）：技术指标（如SMA，EMA，RSI等）。
- 限价单（Limit order）：以指定的限价或更好的价格执行的订单。
- 市价单（Market order）：保证成交，根据订单大小可能影响价格。
- 当前利润（Current Profit）：此交易的当前悬而未决（未实现）利润。这主要用于整个机器人和用户界面。
- 实现利润（Realized Profit）：已实现的利润。仅与部分出口相关 - 这也解释了此计算逻辑。
- 总利润（Total Profit）：已实现和未实现利润的总和。相对数值（%）是根据在此交易中的总投资计算的。
- 这些术语有助于您更好地理解Freqtrade交易机器人的工作原理和操作。在使用机器人进行实际交易时，了解这些术语将有助于您更好地控制和优化您的交易策略。

## Fee handling
Freqtrade的所有利润计算都包括费用。对于回测/超参数优化/模拟交易模式，将使用交易所默认的费用（交易所最低的费率层）。对于实际操作，将使用交易所实际收取的费用（包括BNB折扣等）。

在进行回测、超参数优化和模拟交易时，考虑费用是很重要的，因为它们会影响交易策略的实际效果。而在实际交易中，费用的计算将更为精确，这有助于更好地评估策略的表现。因此，在进行策略分析和优化时，始终要考虑费用，以确保获得真实且可靠的结果。

## Bot execution logic

使用`freqtrade trade`开启机器人和交易循环，这将会调用`bot_start()`回调函数

默认机器人每隔`internals.process_throttle_secs`时间进行循环并执行以下操作：

- 从本地数据库中获取未平仓交易

  本地数据库储存包含了交易机器人的状态、配置、开放交易以及交易历史等信息。这些信息保存在一个本地数据库中sqlite，当你执行买入、卖出等操作时，交易机器人会通过API与交易所通信，下单并跟踪订单状态。但这些交易信息会同步保存在本地数据库中，以便交易策略和其他功能可以访问和处理这些信息。

- 计算当前可交易的交易对列表，需要根据交易所支持的交易对、交易策略中定义的交易对以及过滤器所定义的限制来确定。

  以下是计算当前可交易对列表的一般步骤：

  - 从交易所获取所有支持的交易对。
  - 根据交易策略中配置的交易对列表，从交易所支持的交易对中筛选出需要的交易对。这通常在`config.json`文件或策略类中定义。
  - 应用交易对过滤器（如`VolumePairList`、`AgeFilter`、`SpreadFilter`等），进一步筛选出符合条件的交易对。这些过滤器可以在`config.json`文件中配置。
  - 最后得到的交易对列表即为当前可交易的交易对。

- 下载配对列表的 OHLCV 数据，包括所有信息对，此步骤每个 Candle 仅执行一次，以避免不必要的网络流量。

  下载的数据量取决于策略中指定的最大时间跨度。这是通过在策略文件中设置`timeframe`属性和`startup_candle_count`属性来实现的。

  ```python
  # 机器人开始执行时，它会下载最近的100个小时的OHLCV数据。
  timeframe = '1h'	#周期
  startup_candle_count = 100  #开始蜡烛数量
  ```

- 调用`bot_loop_start()`策略回调

- 分析每个交易对策略

  - 调用`populate_indicators()`计算指标
  - 调用`populate_entry_trend()`计算买入信号
  - 调用 `populate_exit_trend()` 计算卖出信号

- 检查开放订单的超时，是**确保**订单在交易所上**不会无限期地等待执行**的重要步骤，`reqtrade`会定期检查每个未完成的订单，以确保它们在合理的时间范围内得到执行。

  -  `check_entry_timeout()` 检查买入挂单超时时间
  - `check_exit_timeout()` 策略回调检查卖出挂单超时时间
  -  `adjust_entry_price()` 策略回调开放的入场订单的价格。

  在`config.json`文件中为买入和卖出订单设置超时

  ```python
  "unfilledtimeout": {
          "buy": 10,			#单位分钟
          "sell": 30
      }
  ```

  当一个订单**挂单**超过配置的超时时间时，Freqtrade会尝试取消该订单，然后，根据订单类型（买入或卖出）和策略设置，机器人可以执行其他操作，如寻找新的交易机会或尝试以新价格出售资产。请注意，为了使超时检查正常工作，您需要确保配置文件中的交易循环间隔（`internals.process_throttle_secs`）设置得足够短。较长的交易循环间隔可能会导致较长的订单超时检查延迟。

- 验证现有头寸并最终下达退出订单。

  验证现有头寸并根据需要设置出场订单是很重要的。当交易符合特定条件时，例如达到止盈、止损或其他退出条件，Freqtrade 会将现有头寸的出场订单设置好。

  - 考虑止损、ROI 和退出信号、custom_exit() 和 custom_stoploss()。
  - 根据 exit_pricing 配置设置或使用 custom_exit_price() 回调确定退出价格。
  - 在下达退出订单之前，调用 confirm_trade_exit() 策略回调。

- 如果adjust_trade_position() 启用，检查未平仓交易的头寸调整，并在需要时下达额外订单。例如，您可以在头寸开始盈利时添加止损订单或在达到特定目标时将止损订单提高到保本水平。

- 检查当前开放的交易数量是否达到了 `max_open_trades` 的限制。如果达到了限制，将不会再开放新的交易。当您想要在新的交易机会出现时检查是否有足够的交易空位时，Freqtrade会自动为您处理这个检查。您不需要在策略中编写额外的代码来实现这个功能，因为它是框架内置的。

- 验证入场信号并尝试进入新仓位

  - **确定入场价格**：根据 `entry_pricing` 配置设置确定入场价格，或者通过实现 `custom_entry_price()` 回调方法自定义入场价格。

  - **确定杠杆（适用于保证金和期货模式）**：在保证金和期货模式下，将调用策略的 `leverage()` 回调方法以确定所需的杠杆。

  - **确定仓位大小**：通过调用 `custom_stake_amount()` 回调方法确定下单的仓位大小。

  - **确认交易入场**：在下达入场订单之前，将调用策略的 `confirm_trade_entry()` 回调方法以进行最终确认。

这个循环将一次又一次地重复，直到机器人停止。

## Backtesting / Hyperopt execution logic

回测或 优化 只做上述逻辑的一部分，因为大部分交易操作都是完全模拟的。

- 从配置的交易对获取历史数据
- 调用一次`bot_start`方法
- 调用`populate_indicators()`计算指标，每个交易对调用一次
- 调用 `populate_entry_trend()` 和 `populate_exit_trend()` 计算入场，出场信号，每个交易对调用一次
- 循环每根K线，模拟入场和出场点
  - 策略回调`bot_loop_start()`
  - 检查订单超时，通过配置文件的`unfilledtimeout`或者策略中的`check_entry_timeout() / check_exit_timeout()`回调
  - 策略回调`adjust_entry_price()`当回调函数被调用时，Freqtrade 将检查新的买入价格是否低于当前订单的买入价格。如果新的价格低于当前订单价格，Freqtrade 将取消当前订单并使用新的价格重新下单。
  - 检查交易入场信号(enter_long / enter_short)，做多或做空的入场信号
  - 确认交易进入/退出（如果在策略中实施，则调用 confirm_trade_entry() 和 confirm_trade_exit()）。
  - 调用 custom_entry_price()（如果在策略中实施）以确定入场价（价格移动到开盘蜡烛内）。
  - 在保证金和期货模式下，将调用策略的 `leverage()` 回调方法以确定所需的杠杆。
  - 通过调用 `custom_stake_amount()` 回调方法确定下单的仓位大小。
  - 如果adjust_trade_position() 启用，检查未平仓交易的头寸调整，并在需要时下达额外订单
  - custom_exit() 和 custom_stoploss()找到自定义退出点
  - 对于基于退出信号、自定义退出和部分退出的退出：调用 custom_exit_price() 以确定退出价格（价格移动到收盘蜡烛内）。
- 输出回测报告